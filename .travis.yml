language: python
python: 
  - "3.5"
install:
  - pip install -r requirements.txt
  - "pip install coveralls"
env:
  - COVERAGE_FILE=".coverage"
  - FLASK_APP="api/run.py"
  - SECRET="some-fancy long development secret"
  - APP_SETTINGS="development"
  - TEST_DATABASE_URL="postgresql://postgres@localhost:5432/shopping_test_db"
services:
  - postgresql
before_script:
  - psql -c 'create database shopping_test_db;' -U postgres
  - psql -c "CREATE USER startups WITH PASSWORD 'pass';" -U postgres
  - psql -c "grant all privileges on database shopping_test_db to startups;" -U postgres
  - psql -c 'GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO startups;' -U postgres
script:  sh -c 'cd ./api/ python manage.py test'
after_success:
  sh -c 'cd ./api/ && coveralls'
